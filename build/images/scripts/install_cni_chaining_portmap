#!/usr/bin/env bash

cni_conf="/host/etc/cni/net.d/10-antrea.conflist"
content=$(cat $cni_conf | jq '.plugins += [{"type": "portmap", "capabilities": {"portMappings": true}}]')
echo "$content" > $cni_conf

# Install Antrea binary file
install -m 755 /usr/local/bin/antrea-cni /host/opt/cni/bin/antrea
# Install PortMap CNI binary file
if [ ! -f /host/opt/cni/bin/portmap ]; then
    install -m 755 /opt/cni/bin/portmap /host/opt/cni/bin/portmap
fi

id
# Load the OVS kernel module
modprobe openvswitch
