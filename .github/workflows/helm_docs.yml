name: Helm docs
on:
  pull_request:
    branches:
    - main
    - release-*
    - feature/*
  push:
    branches:
    - main
    - release-*
    - feature/*

jobs:
  check-helm-docs:
    name: Check whether autogenerated Helm chart documentation is up-to-date
    runs-on: [ubuntu-latest]
    steps:
    - uses: actions/checkout@v3
    - name: Run helm-docs
      working-directory: build/charts/
      run: |
        make helm-docs
    - name: Check for changes
      working-directory: build/charts/
      run: |
        DIFF=$(git diff .)
        if [ -n "$DIFF" ]; then
          echo "The Helm chart documentation is out-of-date; please run 'make helm-docs' in 'build/charts/' and commit the changes"
          exit 1
        fi
