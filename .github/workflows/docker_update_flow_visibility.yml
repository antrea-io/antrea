# Anyone with write permissions to the antrea-io/antrea Github repository can
# trigger this workflow manually, but please check with a maintainer first. The
# workflow will tag and push flow visibility related image for Jenkins e2e tests.
name: Manually update flow visibility Docker images

on:
  workflow_dispatch:
    inputs:
      ch-operator-tag:
        description: 'Tag for clickhouse-operator and metrics-exporter Docker image'
        required: true
      ch-server-tag:
        description: 'Tag for clickhouse-server'
        required: true

jobs:
  mirror-images:
    runs-on: ubuntu-latest
    steps:
      - name: Login to DockerHub
        uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      - name: Push antrea/clickhouse-operator
        uses: akhilerm/tag-push-action@v2.0.0
        with:
          src: docker.io/altinity/clickhouse-operator:${{ github.event.inputs.ch-operator-tag }}
          dst: |
            docker.io/antrea/clickhouse-operator:${{ github.event.inputs.ch-operator-tag }}
      - name: Push antrea/metrics-exporter
        uses: akhilerm/tag-push-action@v2.0.0
        with:
          src: docker.io/altinity/metrics-exporter:${{ github.event.inputs.ch-operator-tag }}
          dst: |
            docker.io/antrea/metrics-exporter:${{ github.event.inputs.ch-operator-tag }}
      - name: Push antrea/clickhouse-server
        uses: akhilerm/tag-push-action@v2.0.0
        with:
          src: docker.io/yandex/clickhouse-server:${{ github.event.inputs.ch-server-tag }}
          dst: |
            docker.io/antrea/clickhouse-server:${{ github.event.inputs.ch-server-tag }}
